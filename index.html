<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gateway Properties Map</title>
  <link rel="stylesheet" href="styles/app.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <div class="gaHeader">
    <h1>Gateway Properties Map</h1>
    <p class="sub">Property Filters</p>
  </div>

  <div class="toolbar">
    <div class="group">
      <label for="rvpFilter">RVP</label>
      <select id="rvpFilter"><option value="All">All</option></select>
    </div>
    <div class="group">
      <label for="rpmFilter">Regional Manager</label>
      <select id="rpmFilter"><option value="All">All</option></select>
    </div>
    <div class="group">
      <label for="stateFilter">State</label>
      <select id="stateFilter">
        <option value="All">All</option>
        <option>AL</option><option>FL</option><option>GA</option><option>KS</option>
        <option>LA</option><option>NC</option><option>OK</option><option>SC</option>
        <option>TN</option><option>VA</option>
      </select>
    </div>
    <div class="group">
      <label for="typeFilter">Property Type</label>
      <select id="typeFilter">
        <option value="All">All</option>
        <option>55</option><option>62</option><option>C</option>
        <option>F</option><option>RD-62</option><option>S</option>
      </select>
    </div>
    <div class="group">
      <label for="ownerFilter">Owner</label>
      <select id="ownerFilter"><option value="All">All</option></select>
    </div>
    <div class="group">
      <label for="legalFilter">Legal Entity</label>
      <select id="legalFilter"><option value="All">All</option></select>
    </div>
    <!-- removed status filter + export button -->
  </div>

  <div id="map" class="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([34.5, -86.6], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const markersGroup = L.layerGroup().addTo(map);
    let allProps = [];
    let allMarkers = [];
    let totalPortfolio = 0;
    let totalEligible = 0;

    const uniqueSorted = arr => [...new Set(arr.filter(Boolean))].sort((a,b)=>a.localeCompare(b));

    function addOptions(selectId, values) {
      const sel = document.getElementById(selectId);
      [...sel.querySelectorAll('option:not([value="All"])')].forEach(o => o.remove());
      values.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v; opt.textContent = v;
        sel.appendChild(opt);
      });
    }

    // Color/shape per Type (no status border)
    function getMarkerOptions(type) {
      switch (type) {
        case '55':   return { color: '#60d5d7', shape: 'circle' };
        case '62':   return { color: '#10b981', shape: 'circle' };
        case 'F':    return { color: '#f59e0b', shape: 'square' };
        case 'C':    return { color: '#8b5cf6', shape: 'diamond' };
        case 'S':    return { color: '#ef4444', shape: 'star' };
        case 'RD-62':return { color: '#10b981', shape: 'circle' };
        default:     return { color: '#3b82f6', shape: 'circle' };
      }
    }

    function makeMarker(prop) {
      const opt = getMarkerOptions(prop.type);
      let shapeCSS = `width:20px;height:20px;background:${opt.color};box-shadow:0 2px 4px rgba(0,0,0,.2);`;
      if (opt.shape === 'circle') shapeCSS += 'border-radius:50%;';
      else if (opt.shape === 'square') shapeCSS += 'border-radius:4px;';
      else if (opt.shape === 'diamond') shapeCSS += 'transform:rotate(45deg);border-radius:3px;';
      else if (opt.shape === 'star') shapeCSS += 'clip-path:polygon(50% 0%,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%);';
